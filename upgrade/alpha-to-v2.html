<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.13" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <title>Migration SesameÂ : Alpha â†’ v2 | Sesame</title><meta name="description" content="Sesame gestionnaire d'identitÃ©s">
    <link rel="preload" href="/sesame-doc/assets/style-DADYFlon.css" as="style"><link rel="stylesheet" href="/sesame-doc/assets/style-DADYFlon.css">
    <link rel="modulepreload" href="/sesame-doc/assets/app-CNo3EHYg.js"><link rel="modulepreload" href="/sesame-doc/assets/alpha-to-v2.html-Dt0pb5kM.js">
    <link rel="prefetch" href="/sesame-doc/assets/index.html-Bgori5Zd.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/exempleapi.html-BWb3pB5r.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/filtres.html-Do60Nz2Y.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/photo.html-Dev60gNr.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/personalisation_tuiles.html-Dp21T0I7.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/backend_AD.html-eJ677weG.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/backend_LDAP.html-BrRVRW6H.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/backends.html-DkVMJLWA.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/librairie_python.html-BiTsEP0m.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/architecture.html-CJCJBbpC.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/config-gestion-mdp.html-DqiVMb5E.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/cyclevie.html-FS6tYaaf.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/data.html-_98_E6Cp.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/exemple.html-B-IQgsTY.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/formulaire.html-Ifi3VRMY.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/validation.html-BtAKJXJW.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/configuration.html-CtpUUulV.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/configyml.html-Dk2UzvKp.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/importtaiga.html-DxFvpug6.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/architecture-de-securite.html-BEUNtPwc.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/gestion-mdp.html-D3B4fZbC.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/get-started.html-B66NovhY.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/installation-daemon.html-CRqoea-C.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/installation-server.html-BpVuzdzI.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/installation-taiga.html-RGQOD8V0.js" as="script"><link rel="prefetch" href="/sesame-doc/assets/404.html-BNdA4pg8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/sesame-doc/"><!----><span class="vp-site-name" aria-hidden="true">Sesame</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/sesame-doc/" aria-label="Introduction"><!---->Introduction<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Installation <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/installation/installation-server.html" aria-label="Installation rapide"><!---->Installation rapide<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/installation/installation-daemon.html" aria-label="Installation sesame-daemon"><!---->Installation sesame-daemon<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/installation/installation-taiga.html" aria-label="Installation import Taiga"><!---->Installation import Taiga<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/installation/gestion-mdp.html" aria-label="Installation du frontal de gestion du mot de passe"><!---->Installation du frontal de gestion du mot de passe<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/installation/architecture-de-securite.html" aria-label="Architecture de sÃ©curitÃ©"><!---->Architecture de sÃ©curitÃ©<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Configuration <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/architecture.html" aria-label="Architecture"><!---->Architecture<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/data.html" aria-label="Principe"><!---->Principe<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/validation.html" aria-label="Validation et description des donnÃ©es"><!---->Validation et description des donnÃ©es<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/formulaire.html" aria-label="Formulaire"><!---->Formulaire<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/config-gestion-mdp.html" aria-label="Configuration de la politique de mot de passe"><!---->Configuration de la politique de mot de passe<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/configuration/cyclevie.html" aria-label="Cycle de vie"><!---->Cycle de vie<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Importation <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/import/configuration.html" aria-label="Import des donnÃ©es"><!---->Import des donnÃ©es<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/import/configyml.html" aria-label="Configuration de l&#39;import"><!---->Configuration de l&#39;import<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/import/importtaiga.html" aria-label="Import depuis taiga"><!---->Import depuis taiga<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Backends <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/backends/backends.html" aria-label="Introduction"><!---->Introduction<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/backends/librairie_python.html" aria-label="Librairie d&#39;aide Python"><!---->Librairie d&#39;aide Python<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/backends/backend_AD.html" aria-label="Backend AD"><!---->Backend AD<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/backends/backend_LDAP.html" aria-label="Backend LDAP"><!---->Backend LDAP<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Utilisation de l&#39;API <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/Api/filtres.html" aria-label="Les filtres de recherches pour l&#39;API"><!---->Les filtres de recherches pour l&#39;API<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/Api/photo.html" aria-label="rÃ©cupÃ©ration de la photo d&#39;une identitÃ©"><!---->rÃ©cupÃ©ration de la photo d&#39;une identitÃ©<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/Api/exempleapi.html" aria-label="Exemples d&#39;utilisation de l&#39;API Sesame"><!---->Exemples d&#39;utilisation de l&#39;API Sesame<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Personalisation de l&#39;UI <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/sesame-doc/Ui/personalisation_tuiles.html" aria-label="Personalisation des tuiles de la page d &#39;accueil&#39;"><!---->Personalisation des tuiles de la page d &#39;accueil&#39;<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="migration-sesame-alpha-â†’-v2" tabindex="-1"><a class="header-anchor" href="#migration-sesame-alpha-â†’-v2"><span>Migration SesameÂ : Alpha â†’ v2</span></a></h1><p>Ce guide dÃ©crit la procÃ©dure complÃ¨te pour mettre Ã  niveau une instance Sesame Alpha vers la versionÂ 2 Ã  lâ€™aide des deux scripts fournis dans le gist suivantÂ : <a href="https://gist.github.com/tacxou/6631662c8fbe6aa8357f08a61cb55004" target="_blank" rel="noopener noreferrer">https://gist.github.com/tacxou/6631662c8fbe6aa8357f08a61cb55004</a>.</p><h2 id="pre-requis" tabindex="-1"><a class="header-anchor" href="#pre-requis"><span>PrÃ©-requis</span></a></h2><ul><li>Sauvegarde rÃ©cente et vÃ©rifiÃ©e (base de donnÃ©es, fichiers <code>configs/</code>, <code>certificates/</code>, volumes applicatifs).</li><li>PythonÂ 3.9+ et <code>pip</code> disponibles sur la machine dâ€™administration.</li><li>Librairie Python <code>requests</code> installÃ©e (<code>pip install requests</code>).</li><li>AccÃ¨s rÃ©seau et droits suffisants pour arrÃªter/dÃ©marrer les conteneurs Sesame ainsi que pour appeler lâ€™API Sesame (token dâ€™administration nÃ©cessaire pour le script de nettoyage des cycles de vie).</li></ul><blockquote><p>ğŸ’¡ Positionnez-vous dans le rÃ©pertoire racine du projet Sesame (<code>/data/sesame</code>) pour lâ€™ensemble des commandes.</p></blockquote><h2 id="_1-arreter-les-conteneurs-sesame" tabindex="-1"><a class="header-anchor" href="#_1-arreter-les-conteneurs-sesame"><span>1. ArrÃªter les conteneurs Sesame</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token builtin class-name">cd</span> /data/sesame</span>
<span class="line"><span class="token function">docker</span> compose down</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>VÃ©rifiez quâ€™aucun conteneur applicatif <code>sesame-*</code> ne reste actif (Ã  lâ€™exception Ã©ventuelle des services de base de donnÃ©es).</p><h2 id="_2-lancer-le-script-d-upgrade" tabindex="-1"><a class="header-anchor" href="#_2-lancer-le-script-d-upgrade"><span>2. Lancer le script dâ€™upgrade</span></a></h2><ol><li>TÃ©lÃ©chargez les scripts depuis le gist (Ã  exÃ©cuter une seule fois ou lors de chaque mise Ã  jour si vous souhaitez les renouveler)Â :<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> scripts</span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://gist.githubusercontent.com/tacxou/6631662c8fbe6aa8357f08a61cb55004/raw/sesame-upgrade-to-v2.py&quot;</span> <span class="token parameter variable">-o</span> scripts/sesame-upgrade-to-v2.py</span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://gist.githubusercontent.com/tacxou/6631662c8fbe6aa8357f08a61cb55004/raw/sesame-cleanup-lifecycle.py&quot;</span> <span class="token parameter variable">-o</span> scripts/sesame-cleanup-lifecycle.py</span>
<span class="line"><span class="token function">chmod</span> +x scripts/sesame-upgrade-to-v2.py scripts/sesame-cleanup-lifecycle.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>ExÃ©cutez le script dâ€™upgrade (il demandera des confirmations si nÃ©cessaire)Â :<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">python3 scripts/sesame-upgrade-to-v2.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>Le script demande l&#39;arrÃªt les services restants avant de dÃ©marrer, puis sauvegarde le <code>docker-compose.yml</code> dâ€™origine (<code>docker-compose.yml.v1.backup</code>) et met Ã  jour la configuration pour SesameÂ v2.</p><h2 id="_3-redemarrer-les-conteneurs" tabindex="-1"><a class="header-anchor" href="#_3-redemarrer-les-conteneurs"><span>3. RedÃ©marrer les conteneurs</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token function">ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Attendez que les services critiques (API, orchestrator, web) soient en bonne santÃ© avant de poursuivre.</p><h2 id="_4-nettoyer-les-cycles-de-vie" tabindex="-1"><a class="header-anchor" href="#_4-nettoyer-les-cycles-de-vie"><span>4. Nettoyer les cycles de vie</span></a></h2><p>Le script de nettoyage requiert un token dâ€™API Sesame avec les droits dâ€™administration. Vous pouvez soitÂ :</p><ul><li>fournir le token via la variable dâ€™environnement <code>SESAME_API_TOKEN</code>,</li><li>ou stocker le token dans un fichier <code>.env</code> compatible (clÃ© <code>SESAME_API_TOKEN=</code>).</li></ul><p>Exemple dâ€™exÃ©cution en utilisant un fichier <code>.env</code> existantÂ :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">python3 scripts/sesame-cleanup-lifecycle.py --env-file configs/sesame-taiga-crawler/.env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Par dÃ©faut, le script cible lâ€™API sur <code>http://127.0.0.1:3333/api</code>. Adaptez lâ€™URL si nÃ©cessaire (<code>--base-url https://votre-hote/api</code>). Pour effectuer un test Ã  blanc, ajoutez <code>--dry-run</code>.</p><h2 id="_5-verifications-post-migration" tabindex="-1"><a class="header-anchor" href="#_5-verifications-post-migration"><span>5. VÃ©rifications post-migration</span></a></h2><ul><li>ContrÃ´lez les logsÂ : <code>docker compose logs -f sesame-orchestrator</code>.</li><li>Validez lâ€™accÃ¨s Ã  lâ€™interface Sesame et le fonctionnement des workflows.</li><li>Confirmez que les cycles de vie des identitÃ©s sont Ã  lâ€™Ã©tat attendu (<code>O</code>).</li><li>Conservez la sauvegarde <code>docker-compose.yml.v1.backup</code> tant que la migration nâ€™est pas dÃ©finitivement validÃ©e.</li></ul><h2 id="_6-nettoyage-optionnel" tabindex="-1"><a class="header-anchor" href="#_6-nettoyage-optionnel"><span>6. Nettoyage optionnel</span></a></h2><ul><li>Supprimez les scripts dans <code>scripts/</code> afin de ne pas les relancer si la migration Ã  bien Ã©tÃ© faites.</li></ul><p>La migration Alpha â†’ v2 est terminÃ©e lorsque les services sont stables et que toutes les vÃ©rifications mÃ©tiers sont validÃ©es.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 12997062+tacxou@users.noreply.github.com">Tacx</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/sesame-doc/assets/app-CNo3EHYg.js" defer></script>
  </body>
</html>
