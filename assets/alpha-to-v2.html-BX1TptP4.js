import{_ as e,c as s,o as a,a as n}from"./app-Wjr34Ize.js";const i={},t=n(`<h1 id="migration-sesame-alpha-â†’-v2" tabindex="-1"><a class="header-anchor" href="#migration-sesame-alpha-â†’-v2"><span>Migration SesameÂ : Alpha â†’ v2</span></a></h1><p>Ce guide dÃ©crit la procÃ©dure complÃ¨te pour mettre Ã  niveau une instance Sesame Alpha vers la versionÂ 2 Ã  lâ€™aide des deux scripts fournis dans le gist suivantÂ : <a href="https://gist.github.com/tacxou/6631662c8fbe6aa8357f08a61cb55004" target="_blank" rel="noopener noreferrer">https://gist.github.com/tacxou/6631662c8fbe6aa8357f08a61cb55004</a>.</p><h2 id="pre-requis" tabindex="-1"><a class="header-anchor" href="#pre-requis"><span>PrÃ©-requis</span></a></h2><ul><li>Sauvegarde rÃ©cente et vÃ©rifiÃ©e (base de donnÃ©es, fichiers <code>configs/</code>, <code>certificates/</code>, volumes applicatifs).</li><li>PythonÂ 3.9+ et <code>pip</code> disponibles sur la machine dâ€™administration.</li><li>Librairie Python <code>requests</code> installÃ©e (<code>pip install requests</code>).</li><li>AccÃ¨s rÃ©seau et droits suffisants pour arrÃªter/dÃ©marrer les conteneurs Sesame ainsi que pour appeler lâ€™API Sesame (token dâ€™administration nÃ©cessaire pour le script de nettoyage des cycles de vie).</li></ul><blockquote><p>ğŸ’¡ Positionnez-vous dans le rÃ©pertoire racine du projet Sesame (<code>/data/sesame</code>) pour lâ€™ensemble des commandes.</p></blockquote><h2 id="_1-arreter-les-conteneurs-sesame" tabindex="-1"><a class="header-anchor" href="#_1-arreter-les-conteneurs-sesame"><span>1. ArrÃªter les conteneurs Sesame</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token builtin class-name">cd</span> /data/sesame</span>
<span class="line"><span class="token function">docker</span> compose down</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>VÃ©rifiez quâ€™aucun conteneur applicatif <code>sesame-*</code> ne reste actif (Ã  lâ€™exception Ã©ventuelle des services de base de donnÃ©es).</p><h2 id="_2-lancer-le-script-d-upgrade" tabindex="-1"><a class="header-anchor" href="#_2-lancer-le-script-d-upgrade"><span>2. Lancer le script dâ€™upgrade</span></a></h2><ol><li>TÃ©lÃ©chargez les scripts depuis le gist (Ã  exÃ©cuter une seule fois ou lors de chaque mise Ã  jour si vous souhaitez les renouveler)Â :<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> scripts</span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://gist.githubusercontent.com/tacxou/6631662c8fbe6aa8357f08a61cb55004/raw/sesame-upgrade-to-v2.py&quot;</span> <span class="token parameter variable">-o</span> scripts/sesame-upgrade-to-v2.py</span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://gist.githubusercontent.com/tacxou/6631662c8fbe6aa8357f08a61cb55004/raw/sesame-cleanup-lifecycle.py&quot;</span> <span class="token parameter variable">-o</span> scripts/sesame-cleanup-lifecycle.py</span>
<span class="line"><span class="token function">chmod</span> +x scripts/sesame-upgrade-to-v2.py scripts/sesame-cleanup-lifecycle.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>ExÃ©cutez le script dâ€™upgrade (il demandera des confirmations si nÃ©cessaire)Â :<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">python3 scripts/sesame-upgrade-to-v2.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>Le script demande l&#39;arrÃªt les services restants avant de dÃ©marrer, puis sauvegarde le <code>docker-compose.yml</code> dâ€™origine (<code>docker-compose.yml.v1.backup</code>) et met Ã  jour la configuration pour SesameÂ v2.</p><h2 id="_3-redemarrer-les-conteneurs" tabindex="-1"><a class="header-anchor" href="#_3-redemarrer-les-conteneurs"><span>3. RedÃ©marrer les conteneurs</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token function">ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Attendez que les services critiques (API, orchestrator, web) soient en bonne santÃ© avant de poursuivre.</p><h2 id="_4-nettoyer-les-cycles-de-vie" tabindex="-1"><a class="header-anchor" href="#_4-nettoyer-les-cycles-de-vie"><span>4. Nettoyer les cycles de vie</span></a></h2><p>Le script de nettoyage requiert un token dâ€™API Sesame avec les droits dâ€™administration. Vous pouvez soitÂ :</p><ul><li>fournir le token via la variable dâ€™environnement <code>SESAME_API_TOKEN</code>,</li><li>ou stocker le token dans un fichier <code>.env</code> compatible (clÃ© <code>SESAME_API_TOKEN=</code>).</li></ul><p>Exemple dâ€™exÃ©cution en utilisant un fichier <code>.env</code> existantÂ :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">python3 scripts/sesame-cleanup-lifecycle.py --env-file configs/sesame-taiga-crawler/.env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Par dÃ©faut, le script cible lâ€™API sur <code>http://127.0.0.1:3333/api</code>. Adaptez lâ€™URL si nÃ©cessaire (<code>--base-url https://votre-hote/api</code>). Pour effectuer un test Ã  blanc, ajoutez <code>--dry-run</code>.</p><h2 id="_5-verifications-post-migration" tabindex="-1"><a class="header-anchor" href="#_5-verifications-post-migration"><span>5. VÃ©rifications post-migration</span></a></h2><ul><li>ContrÃ´lez les logsÂ : <code>docker compose logs -f sesame-orchestrator</code>.</li><li>Validez lâ€™accÃ¨s Ã  lâ€™interface Sesame et le fonctionnement des workflows.</li><li>Confirmez que les cycles de vie des identitÃ©s sont Ã  lâ€™Ã©tat attendu (<code>O</code>).</li><li>Conservez la sauvegarde <code>docker-compose.yml.v1.backup</code> tant que la migration nâ€™est pas dÃ©finitivement validÃ©e.</li></ul><h2 id="_6-nettoyage-optionnel" tabindex="-1"><a class="header-anchor" href="#_6-nettoyage-optionnel"><span>6. Nettoyage optionnel</span></a></h2><ul><li>Supprimez les scripts dans <code>scripts/</code> afin de ne pas les relancer si la migration Ã  bien Ã©tÃ© faites.</li></ul><p>La migration Alpha â†’ v2 est terminÃ©e lorsque les services sont stables et que toutes les vÃ©rifications mÃ©tiers sont validÃ©es.</p>`,25),r=[t];function l(c,o){return a(),s("div",null,r)}const p=e(i,[["render",l],["__file","alpha-to-v2.html.vue"]]),u=JSON.parse('{"path":"/upgrades/alpha-to-v2.html","title":"Migration SesameÂ : Alpha â†’ v2","lang":"fr-FR","frontmatter":{},"headers":[{"level":2,"title":"PrÃ©-requis","slug":"pre-requis","link":"#pre-requis","children":[]},{"level":2,"title":"1. ArrÃªter les conteneurs Sesame","slug":"_1-arreter-les-conteneurs-sesame","link":"#_1-arreter-les-conteneurs-sesame","children":[]},{"level":2,"title":"2. Lancer le script dâ€™upgrade","slug":"_2-lancer-le-script-d-upgrade","link":"#_2-lancer-le-script-d-upgrade","children":[]},{"level":2,"title":"3. RedÃ©marrer les conteneurs","slug":"_3-redemarrer-les-conteneurs","link":"#_3-redemarrer-les-conteneurs","children":[]},{"level":2,"title":"4. Nettoyer les cycles de vie","slug":"_4-nettoyer-les-cycles-de-vie","link":"#_4-nettoyer-les-cycles-de-vie","children":[]},{"level":2,"title":"5. VÃ©rifications post-migration","slug":"_5-verifications-post-migration","link":"#_5-verifications-post-migration","children":[]},{"level":2,"title":"6. Nettoyage optionnel","slug":"_6-nettoyage-optionnel","link":"#_6-nettoyage-optionnel","children":[]}],"git":{"updatedTime":1764663606000,"contributors":[{"name":"Tacx","email":"12997062+tacxou@users.noreply.github.com","commits":1}]},"filePathRelative":"upgrades/alpha-to-v2.md"}');export{p as comp,u as data};
